# å¾®ä¿¡å°ç¨‹åºåç«¯æœåŠ¡ä¸ç®¡ç†åå°å¼€å‘è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨ä¸ºç°æœ‰çš„TDesigné›¶å”®å°ç¨‹åºæ„å»ºå®Œæ•´çš„åç«¯æœåŠ¡å’Œç®¡ç†åå°ï¼Œå®ç°ä»Mockæ•°æ®å‘çœŸå®æ•°æ®åº“é©±åŠ¨çš„è½¬å‹ã€‚åŸºäºç°æœ‰å°ç¨‹åºé¡¹ç›®æ–°åŠ åç«¯æœåŠ¡å’Œç®¡ç†åå°ã€‚

### ğŸ¯ é¡¹ç›®ç›®æ ‡
- æ„å»ºæ”¯æŒå°ç¨‹åºæ‰€æœ‰åŠŸèƒ½çš„åç«¯APIæœåŠ¡
- å¼€å‘åŠŸèƒ½å®Œå–„çš„ç®¡ç†åå°ç³»ç»Ÿ
- å®ç°æ•°æ®æŒä¹…åŒ–å’Œæ–‡ä»¶å­˜å‚¨
- æä¾›é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ğŸ”§ æŠ€æœ¯æ ˆé€‰æ‹©

#### å‰ç«¯ç®¡ç†åå°
- **Next.js 14**: ç°ä»£å…¨æ ˆæ¡†æ¶ï¼Œæ”¯æŒSSR/SSGï¼Œä¼˜ç§€çš„DX
- **TypeScript**: ç±»å‹å®‰å…¨ï¼Œæå‡ä»£ç è´¨é‡
- **Tailwind CSS**: å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
- **Shadcn/ui**: ç°ä»£åŒ–çš„Reactç»„ä»¶åº“
- **React Hook Form + Zod**: è¡¨å•å¤„ç†å’ŒéªŒè¯

#### åç«¯æœåŠ¡
å¾®ä¿¡è®¤è¯
- **Next.js API Routes**: ç»Ÿä¸€çš„å…¨æ ˆè§£å†³æ–¹æ¡ˆ
- **Supabase**: BaaSå¹³å°ï¼Œæä¾›æ•°æ®åº“ã€è®¤è¯ã€å®æ—¶è®¢é˜…
- **Prisma**: ç°ä»£åŒ–çš„ORMå·¥å…·
- **NextAuth.js**: ç»Ÿä¸€çš„è®¤è¯è§£å†³æ–¹æ¡ˆ

#### æ–‡ä»¶å­˜å‚¨
- **Cloudflare R2**: æˆæœ¬æ•ˆç›Šæœ€ä½³çš„å¯¹è±¡å­˜å‚¨
- **æ”¯æŒå›¾ç‰‡CDNä¼˜åŒ–**

#### éƒ¨ç½²
- **Vercel**: ä¼˜åŒ–çš„Next.jséƒ¨ç½²å¹³å°

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„å›¾
```
å¾®ä¿¡å°ç¨‹åºç«¯ â†â†’ Next.js API Routes â†â†’ Supabase Database
                      â†•                    â†•
                ç®¡ç†åå°ç•Œé¢            Cloudflare R2
                      â†•
                   NextAuth.js
```

### ç›®å½•ç»“æ„è§„åˆ’
```
/backend-admin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # App Router
â”‚   â”‚   â”œâ”€â”€ (dashboard)/       # ç®¡ç†åå°è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ api/               # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/         # ç®¡ç†å‘˜API
â”‚   â”‚   â”‚   â”œâ”€â”€ miniprogram/   # å°ç¨‹åºAPI
â”‚   â”‚   â”‚   â””â”€â”€ upload/        # æ–‡ä»¶ä¸Šä¼ API
â”‚   â”‚   â”œâ”€â”€ auth/              # è®¤è¯é¡µé¢
â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ components/            # å…±äº«ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/               # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ forms/            # è¡¨å•ç»„ä»¶
â”‚   â”‚   â””â”€â”€ layouts/          # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ lib/                  # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ database.ts       # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ auth.ts          # è®¤è¯é…ç½®
â”‚   â”‚   â”œâ”€â”€ upload.ts        # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”‚   â””â”€â”€ utils.ts         # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ types/               # TypeScriptç±»å‹å®šä¹‰
â”‚   â””â”€â”€ middleware.ts        # ä¸­é—´ä»¶
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma        # æ•°æ®åº“æ¨¡å¼
â”‚   â””â”€â”€ seed.ts             # æ•°æ®ç§å­
â”œâ”€â”€ public/
â””â”€â”€ package.json
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

åŸºäºç°æœ‰å°ç¨‹åºçš„æ•°æ®æ¨¡å‹ï¼Œè®¾è®¡ä»¥ä¸‹ä¸»è¦è¡¨ç»“æ„ï¼š

### æ ¸å¿ƒè¡¨ç»“æ„

#### ç”¨æˆ·è¡¨ (users)
```sql
- id (UUID, PK)
- openid (String, å¾®ä¿¡openid)
- unionid (String, å¾®ä¿¡unionid)
- nickname (String)
- avatar_url (String)
- phone (String)
- gender (Integer)
- created_at (DateTime)
- updated_at (DateTime)
```

#### å•†å“è¡¨ (products)
```sql
- id (UUID, PK)
- spu_id (String, å•†å“SPU)
- title (String, å•†å“æ ‡é¢˜)
- description (Text, å•†å“æè¿°)
- category_id (UUID, FK)
- primary_image (String)
- images (JSON, å•†å“å›¾ç‰‡æ•°ç»„)
- status (Integer, å•†å“çŠ¶æ€)
- sort_order (Integer)
- created_at (DateTime)
- updated_at (DateTime)
```

#### å•†å“SKUè¡¨ (product_skus)
```sql
- id (UUID, PK)
- sku_id (String, SKUç¼–ç )
- product_id (UUID, FK)
- price (Decimal, ä»·æ ¼)
- origin_price (Decimal, åŸä»·)
- stock_quantity (Integer, åº“å­˜)
- spec_info (JSON, è§„æ ¼ä¿¡æ¯)
- status (Integer)
- created_at (DateTime)
- updated_at (DateTime)
```

#### åˆ†ç±»è¡¨ (categories)
```sql
- id (UUID, PK)
- name (String)
- parent_id (UUID, FK)
- image (String)
- sort_order (Integer)
- status (Integer)
- created_at (DateTime)
- updated_at (DateTime)
```

#### è´­ç‰©è½¦è¡¨ (carts)
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- sku_id (UUID, FK)
- quantity (Integer)
- selected (Boolean)
- created_at (DateTime)
- updated_at (DateTime)
```

#### è®¢å•è¡¨ (orders)
```sql
- id (UUID, PK)
- order_no (String, è®¢å•å·)
- user_id (UUID, FK)
- status (Integer, è®¢å•çŠ¶æ€)
- total_amount (Decimal)
- discount_amount (Decimal)
- actual_amount (Decimal)
- address_info (JSON, æ”¶è´§åœ°å€ä¿¡æ¯)
- remark (Text)
- created_at (DateTime)
- updated_at (DateTime)
```

#### è®¢å•æ˜ç»†è¡¨ (order_items)
```sql
- id (UUID, PK)
- order_id (UUID, FK)
- sku_id (UUID, FK)
- quantity (Integer)
- price (Decimal)
- total_price (Decimal)
- spec_info (JSON)
- created_at (DateTime)
```

#### åœ°å€è¡¨ (addresses)
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- name (String, æ”¶è´§äºº)
- phone (String)
- province (String)
- city (String)
- district (String)
- detail (String, è¯¦ç»†åœ°å€)
- is_default (Boolean)
- created_at (DateTime)
- updated_at (DateTime)
```

#### ä¼˜æƒ åˆ¸è¡¨ (coupons)
```sql
- id (UUID, PK)
- title (String)
- description (Text)
- type (Integer, ä¼˜æƒ åˆ¸ç±»å‹)
- discount_value (Decimal)
- min_amount (Decimal, æœ€å°ä½¿ç”¨é‡‘é¢)
- start_time (DateTime)
- end_time (DateTime)
- total_count (Integer, æ€»å‘æ”¾é‡)
- used_count (Integer, å·²ä½¿ç”¨é‡)
- status (Integer)
- created_at (DateTime)
- updated_at (DateTime)
```

#### ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨ (user_coupons)
```sql
- id (UUID, PK)
- user_id (UUID, FK)
- coupon_id (UUID, FK)
- status (Integer, ä½¿ç”¨çŠ¶æ€)
- used_at (DateTime)
- order_id (UUID, FK, nullable)
- created_at (DateTime)
```

## ğŸ”Œ APIè®¾è®¡

### å°ç¨‹åºç«¯API (/api/miniprogram/)

#### ç”¨æˆ·æ¨¡å—
- `POST /api/miniprogram/auth/login` - å¾®ä¿¡ç™»å½•
- `GET /api/miniprogram/user/info` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/miniprogram/user/info` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

#### å•†å“æ¨¡å—
- `GET /api/miniprogram/products` - å•†å“åˆ—è¡¨
- `GET /api/miniprogram/products/[id]` - å•†å“è¯¦æƒ…
- `GET /api/miniprogram/categories` - å•†å“åˆ†ç±»
- `GET /api/miniprogram/products/search` - å•†å“æœç´¢

#### è´­ç‰©è½¦æ¨¡å—
- `GET /api/miniprogram/cart` - è·å–è´­ç‰©è½¦
- `POST /api/miniprogram/cart` - æ·»åŠ åˆ°è´­ç‰©è½¦
- `PUT /api/miniprogram/cart/[id]` - æ›´æ–°è´­ç‰©è½¦é¡¹
- `DELETE /api/miniprogram/cart/[id]` - åˆ é™¤è´­ç‰©è½¦é¡¹

#### è®¢å•æ¨¡å—
- `POST /api/miniprogram/orders` - åˆ›å»ºè®¢å•
- `GET /api/miniprogram/orders` - è®¢å•åˆ—è¡¨
- `GET /api/miniprogram/orders/[id]` - è®¢å•è¯¦æƒ…
- `PUT /api/miniprogram/orders/[id]` - æ›´æ–°è®¢å•çŠ¶æ€

#### åœ°å€æ¨¡å—
- `GET /api/miniprogram/addresses` - åœ°å€åˆ—è¡¨
- `POST /api/miniprogram/addresses` - æ–°å¢åœ°å€
- `PUT /api/miniprogram/addresses/[id]` - æ›´æ–°åœ°å€
- `DELETE /api/miniprogram/addresses/[id]` - åˆ é™¤åœ°å€

### ç®¡ç†åå°API (/api/admin/)

#### å•†å“ç®¡ç†
- `GET /api/admin/products` - å•†å“åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰
- `POST /api/admin/products` - åˆ›å»ºå•†å“
- `PUT /api/admin/products/[id]` - æ›´æ–°å•†å“
- `DELETE /api/admin/products/[id]` - åˆ é™¤å•†å“

#### è®¢å•ç®¡ç†
- `GET /api/admin/orders` - è®¢å•åˆ—è¡¨
- `PUT /api/admin/orders/[id]/status` - æ›´æ–°è®¢å•çŠ¶æ€
- `GET /api/admin/orders/statistics` - è®¢å•ç»Ÿè®¡

#### ç”¨æˆ·ç®¡ç†
- `GET /api/admin/users` - ç”¨æˆ·åˆ—è¡¨
- `GET /api/admin/users/[id]` - ç”¨æˆ·è¯¦æƒ…

#### ä¼˜æƒ åˆ¸ç®¡ç†
- `GET /api/admin/coupons` - ä¼˜æƒ åˆ¸åˆ—è¡¨
- `POST /api/admin/coupons` - åˆ›å»ºä¼˜æƒ åˆ¸
- `PUT /api/admin/coupons/[id]` - æ›´æ–°ä¼˜æƒ åˆ¸

## ğŸ–¥ï¸ ç®¡ç†åå°åŠŸèƒ½è§„åˆ’

### 1. ä»ªè¡¨ç›˜
- é”€å”®æ¦‚è§ˆï¼ˆä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆé”€å”®é¢ï¼‰
- è®¢å•ç»Ÿè®¡å›¾è¡¨
- å•†å“åº“å­˜é¢„è­¦
- ç”¨æˆ·å¢é•¿è¶‹åŠ¿

### 2. å•†å“ç®¡ç†
- å•†å“åˆ—è¡¨ï¼ˆæœç´¢ã€ç­›é€‰ã€åˆ†é¡µï¼‰
- å•†å“ç¼–è¾‘ï¼ˆå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€å›¾ç‰‡ä¸Šä¼ ï¼‰
- å•†å“åˆ†ç±»ç®¡ç†ï¼ˆæ ‘å½¢ç»“æ„ï¼‰
- åº“å­˜ç®¡ç†
- å•†å“æ‰¹é‡æ“ä½œ

### 3. è®¢å•ç®¡ç†
- è®¢å•åˆ—è¡¨ï¼ˆå¤šçŠ¶æ€ç­›é€‰ï¼‰
- è®¢å•è¯¦æƒ…æŸ¥çœ‹
- è®¢å•çŠ¶æ€ç®¡ç†
- å‘è´§ç®¡ç†
- é€€æ¬¾å¤„ç†

### 4. ç”¨æˆ·ç®¡ç†
- ç”¨æˆ·åˆ—è¡¨
- ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹
- ç”¨æˆ·æ ‡ç­¾ç®¡ç†

### 5. è¥é”€ç®¡ç†
- ä¼˜æƒ åˆ¸åˆ›å»ºå’Œç®¡ç†
- è¥é”€æ´»åŠ¨é…ç½®
- è½®æ’­å›¾ç®¡ç†

### 6. ç³»ç»Ÿç®¡ç†
- ç®¡ç†å‘˜è´¦æˆ·
- ç³»ç»Ÿé…ç½®
- æ•°æ®å¤‡ä»½
- æ“ä½œæ—¥å¿—

## ğŸ“… å¼€å‘é˜¶æ®µè§„åˆ’

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„æ­å»º (1-2å‘¨)
1. **é¡¹ç›®åˆå§‹åŒ–**
   - åˆ›å»ºNext.jsé¡¹ç›®
   - é…ç½®TypeScriptã€Tailwind CSS
   - é›†æˆShadcn/uiç»„ä»¶åº“
   
2. **æ•°æ®åº“è®¾è®¡**
   - è®¾è®¡Prisma Schema
   - é…ç½®Supabaseè¿æ¥
   - åˆ›å»ºæ•°æ®è¡¨ç»“æ„
   - ç¼–å†™æ•°æ®ç§å­æ–‡ä»¶

3. **è®¤è¯ç³»ç»Ÿ**
   - é…ç½®NextAuth.js
   - å®ç°ç®¡ç†å‘˜ç™»å½•
   - å®ç°å¾®ä¿¡å°ç¨‹åºæˆæƒ

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒAPIå¼€å‘ (2-3å‘¨)
1. **ç”¨æˆ·æ¨¡å—API**
2. **å•†å“æ¨¡å—API**
3. **è´­ç‰©è½¦æ¨¡å—API**
4. **è®¢å•æ¨¡å—API**
5. **åœ°å€æ¨¡å—API**
6. **æ–‡ä»¶ä¸Šä¼ APIï¼ˆR2é›†æˆï¼‰**

### é˜¶æ®µä¸‰ï¼šç®¡ç†åå°å¼€å‘ (3-4å‘¨)
1. **åŸºç¡€å¸ƒå±€å’Œè·¯ç”±**
2. **ä»ªè¡¨ç›˜é¡µé¢**
3. **å•†å“ç®¡ç†é¡µé¢**
4. **è®¢å•ç®¡ç†é¡µé¢**
5. **ç”¨æˆ·ç®¡ç†é¡µé¢**
6. **è¥é”€ç®¡ç†é¡µé¢**

### é˜¶æ®µå››ï¼šå°ç¨‹åºå¯¹æ¥ (1-2å‘¨)
1. **æ›¿æ¢Mockæ•°æ®ä¸ºçœŸå®API**
2. **åŠŸèƒ½æµ‹è¯•å’Œè°ƒè¯•**
3. **æ€§èƒ½ä¼˜åŒ–**

### é˜¶æ®µäº”ï¼šéƒ¨ç½²å’Œä¼˜åŒ– (1å‘¨)
1. **Verceléƒ¨ç½²é…ç½®**
2. **ç¯å¢ƒå˜é‡é…ç½®**
3. **æ€§èƒ½ç›‘æ§**
4. **å®‰å…¨åŠ å›º**

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### ç¯å¢ƒé…ç½®
- **å¼€å‘ç¯å¢ƒ**: æœ¬åœ°å¼€å‘ + Supabaseå¼€å‘å®ä¾‹
- **ç”Ÿäº§ç¯å¢ƒ**: Vercel + Supabaseç”Ÿäº§å®ä¾‹ + Cloudflare R2

### ç¯å¢ƒå˜é‡
```bash
# è®¤è¯
ç®¡ç†åå°æ— éœ€è®¤è¯ï¼Œå°†ä¼šéƒ¨ç½²åœ¨https://china.wm985.top/

# å¾®ä¿¡å°ç¨‹åº
å¾®ä¿¡å°ç¨‹åºçš„ç”¨æˆ·åªéœ€è¦ä½¿ç”¨å¾®ä¿¡ç™»å½•å³å¯ æ— éœ€å¯†ç 
WECHAT_APPID="wx640831368d15e774"
WECHAT_SECRET="f2240eb70ba9f6061979951d23e047bb"

# Cloudflare R2 å­˜å‚¨é…ç½®
STORAGE_ENDPOINT = "https://674e70edb9c85b5003b036fbcd82bee8.r2.cloudflarestorage.com"
STORAGE_REGION = "auto"
STORAGE_ACCESS_KEY = "45df78fdcb100fd68ffedc7518dbc3d4"
STORAGE_SECRET_KEY = "96231c12f68958d02dc06ac775d94cf3697d30c141bdc0094cea6f000b5ebfca"
STORAGE_BUCKET = "hcw"
STORAGE_PUBLIC_URL = "https://pub-7d345f4cf2334fce864509d66ec976f3.r2.dev"


# æ•°æ®åº“
# Supabase
NEXT_PUBLIC_SUPABASE_URL="https://zhlxqqtahpamntbdtbmf.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpobHhxcXRhaHBhbW50YmR0Ym1mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5NjM2MzksImV4cCI6MjA3MTUzOTYzOX0.TtLbRbreNB9L93Al-CZymhZ2uDZJHKw1s2lux_PcIcc"
SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpobHhxcXRhaHBhbW50YmR0Ym1mIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NTk2MzYzOSwiZXhwIjoyMDcxNTM5NjM5fQ.aH8gH_RCnOhds7dKBS-IYvzSqhWjxyuhQXERfwuPHjc"
```
Set-Location backend; npx prisma studio

### éƒ¨ç½²æ­¥éª¤
1. åœ¨æœ¬ä»“åº“çš„æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶å¤¹backendä½œä¸ºåç«¯æœåŠ¡å’Œç®¡ç†åå°çš„æ–‡ä»¶å¤¹
2. é…ç½®ç¯å¢ƒå˜é‡

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **APIå®‰å…¨**
   - JWT Tokenè®¤è¯
   - Rate Limiting
   - CORSé…ç½®
   - è¾“å…¥éªŒè¯å’ŒSQLæ³¨å…¥é˜²æŠ¤

2. **æ•°æ®å®‰å…¨**
   - è®¿é—®æ—¥å¿—è®°å½•

3. **æ–‡ä»¶å®‰å…¨**
   - æ–‡ä»¶ç±»å‹é™åˆ¶
   - æ–‡ä»¶å¤§å°é™åˆ¶

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

1. **æ€§èƒ½ç›‘æ§**
   - Vercel Analytics
   - APIå“åº”æ—¶é—´ç›‘æ§
   - æ•°æ®åº“æ€§èƒ½ç›‘æ§

2. **é”™è¯¯ç›‘æ§**
   - é”™è¯¯æ—¥å¿—æ”¶é›†

## ğŸ¯ åç»­æ‰©å±•è®¡åˆ’

1. **åŠŸèƒ½æ‰©å±•**
   - å¤šå•†æˆ·æ”¯æŒ
   - æ•°æ®åˆ†æç³»ç»Ÿ

2. **æŠ€æœ¯å‡çº§**
   - CDNä¼˜åŒ–
   - ç¼“å­˜ç­–ç•¥

---

## âœ… æ€»ç»“

æ­¤å¼€å‘è®¡åˆ’æ¶µç›–äº†ä»æ¶æ„è®¾è®¡åˆ°éƒ¨ç½²ç»´æŠ¤çš„å®Œæ•´æµç¨‹ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆç¡®ä¿é¡¹ç›®çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚
ä»”ç»†æ ¸å¯¹å‰åç«¯æ¥å£å­—æ®µï¼ŒåŠ¡å¿…ä¸€æ¬¡è·‘é€šé¡¹ç›®ã€‚