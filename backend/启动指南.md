# 🚀 零售管理后台启动指南

## 📦 快速开始

### 1. 进入项目目录
```bash
cd backend
```

### 2. 安装依赖
```bash
npm install
```

### 3. 配置环境变量
复制环境变量模板：
```bash
copy .env.example .env.local
```

编辑 `.env.local` 文件，填入实际配置：
```env
# 数据库 - 使用计划文档中的 Supabase 配置
DATABASE_URL="postgresql://postgres:Hcw19961021@db.zhlxqqtahpamntbdtbmf.supabase.co:5432/postgres"

npx dotenv -e .env.local -- npx prisma studio 这是本地SQL的启动方式，一般不用它

# Supabase
NEXT_PUBLIC_SUPABASE_URL="https://zhlxqqtahpamntbdtbmf.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpobHhxcXRhaHBhbW50YmR0Ym1mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5NjM2MzksImV4cCI6MjA3MTUzOTYzOX0.TtLbRbreNB9L93Al-CZymhZ2uDZJHKw1s2lux_PcIcc"
SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpobHhxcXRhaHBhbW50YmR0Ym1mIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NTk2MzYzOSwiZXhwIjoyMDcxNTM5NjM5fQ.aH8gH_RCnOhds7dKBS-IYvzSqhWjxyuhQXERfwuPHjc"

# 微信小程序
WECHAT_APPID="wx640831368d15e774"
WECHAT_SECRET="f2240eb70ba9f6061979951d23e047bb"

# Cloudflare R2 存储
STORAGE_ENDPOINT="https://674e70edb9c85b5003b036fbcd82bee8.r2.cloudflarestorage.com"
STORAGE_REGION="auto"
STORAGE_ACCESS_KEY="45df78fdcb100fd68ffedc7518dbc3d4"
STORAGE_SECRET_KEY="96231c12f68958d02dc06ac775d94cf3697d30c141bdc0094cea6f000b5ebfca"
STORAGE_BUCKET="hcw"
STORAGE_PUBLIC_URL="https://pub-7d345f4cf2334fce864509d66ec976f3.r2.dev"
```

### 4. 初始化数据库
```bash
# 生成 Prisma 客户端
npm run db:generate

# 推送数据库结构到 Supabase
npm run db:push

# 初始化种子数据（可选）
npm run db:seed
```

### 5. 启动开发服务器
```bash
npm run dev
```

🎉 访问 http://localhost:3000 查看管理后台！

## 📱 小程序对接

小程序端需要将 API 地址指向你的后端服务：

### 开发环境
```javascript
const API_BASE = 'http://localhost:3000/api/miniprogram'
```

### 生产环境
```javascript
const API_BASE = 'https://china.wm985.top/api/miniprogram'
```

## 🔧 常用命令

```bash
# 开发
npm run dev          # 启动开发服务器
npm run build        # 构建生产版本
npm run start        # 启动生产服务器

# 数据库
npm run db:generate  # 生成 Prisma 客户端
npm run db:push      # 推送数据库架构
npm run db:seed      # 初始化数据
npm run db:studio    # 打开 Prisma Studio

# 代码质量
npm run lint         # ESLint 检查
```

## 📊 功能模块

### 管理后台页面
- **仪表盘** (`/`) - 销售概览和统计图表
- **商品管理** (`/products`) - 商品列表、编辑、状态管理
- **订单管理** (`/orders`) - 订单查看、状态更新、发货处理
- **用户管理** (`/users`) - 用户信息查看和统计
- **优惠券** (`/coupons`) - 优惠券创建和管理
- **轮播图** (`/banners`) - 首页轮播图配置

### 小程序 API 接口
- **用户认证** - 微信登录、用户信息管理
- **商品浏览** - 商品列表、详情、分类、搜索
- **购物车** - 添加、修改、删除购物车商品
- **订单流程** - 下单、支付、查看、取消
- **地址管理** - 收货地址的增删改查
- **营销功能** - 轮播图、优惠券领取

## 🚀 部署到 Vercel

1. 推送代码到 GitHub 仓库
2. 在 Vercel 中连接仓库
3. 配置环境变量（与 .env.local 相同）
4. 自动部署完成

## 🔐 环境变量说明

| 变量名 | 说明 | 必需 |
|--------|------|------|
| `DATABASE_URL` | PostgreSQL 数据库连接串 | ✅ |
| `NEXT_PUBLIC_SUPABASE_URL` | Supabase 项目 URL | ✅ |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabase 匿名密钥 | ✅ |
| `SUPABASE_SERVICE_ROLE_KEY` | Supabase 服务角色密钥 | ✅ |
| `WECHAT_APPID` | 微信小程序 AppID | ✅ |
| `WECHAT_SECRET` | 微信小程序密钥 | ✅ |
| `STORAGE_ENDPOINT` | Cloudflare R2 端点 | ✅ |
| `STORAGE_ACCESS_KEY` | R2 访问密钥 | ✅ |
| `STORAGE_SECRET_KEY` | R2 秘密密钥 | ✅ |
| `STORAGE_BUCKET` | R2 存储桶名称 | ✅ |
| `STORAGE_PUBLIC_URL` | R2 公共访问 URL | ✅ |

## 🐛 常见问题

### 1. 数据库连接失败
- 检查 `DATABASE_URL` 是否正确
- 确认网络能访问 Supabase

### 2. 图片上传失败
- 检查 Cloudflare R2 配置
- 确认存储桶权限设置

### 3. 微信登录失败
- 检查 `WECHAT_APPID` 和 `WECHAT_SECRET`
- 确认小程序后台配置的域名

## 📞 技术支持

如有问题，请查看：
1. README.md 文档
2. 后端和管理后台的计划.md 设计文档
3. GitHub Issues

祝你使用愉快！🎉